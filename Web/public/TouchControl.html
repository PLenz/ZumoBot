<!doctype html>
<html lang=en>
   <head>
      <meta charset=utf-8>
      <meta content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0," />
      <title></title>
      <style type="text/css">
         * {
         -webkit-touch-callout: none; /* prevent callout to copy image, etc when tap to hold */
         -webkit-text-size-adjust: none; /* prevent webkit from resizing text to fit */
         /* make transparent link selection, adjust last value opacity 0 to 1.0 */
         -webkit-tap-highlight-color: rgba(0,0,0,0);
         -webkit-user-select: none; /* prevent copy paste, to allow, change 'none' to 'text' */
         -webkit-tap-highlight-color: rgba(0,0,0,0);
         }
         body {
         background: black;
         margin: 0px;
         }
         canvas {
         display:block;
         position:absolute;
         }
         .container {
         width:auto;
         text-align:center;
         background-color:#ff0000;
         }
      </style>
   </head>
   <body>
      <script src="js/touch-emulator.js"></script>
      <script src="js/Vector2.js"></script>
      <script>
         if (is_touch_device() == false) {
          TouchEmulator();
         }
             var canvas,
              	c, // c is the canvas' context 2D
             	container,
             	halfWidth,
             	halfHeight,
             	leftTouchID = -1,
             	leftTouchPos = new Vector2(0,0),
             	leftTouchStartPos = new Vector2(0,0),
             	leftVector = new Vector2(0,0);


             setupCanvas();

             var touchable = 'createTouch' in document,
             	touches = [];

             setInterval(draw, 1000/35);

             if(touchable) {
             	canvas.addEventListener( 'touchstart', onTouchStart, false );
             	canvas.addEventListener( 'touchmove', onTouchMove, false );
             	canvas.addEventListener( 'touchend', onTouchEnd, false );

             	window.onorientationchange = resetCanvas;
             	window.onresize = resetCanvas;
             }

         function is_touch_device() {
         try {
         document.createEvent("TouchEvent");
         return true;
         } catch (e) {
         return false;
         }
         }

             function resetCanvas (e) {
               canvas.width = window.innerWidth;
             	canvas.height = window.innerHeight;

             	halfWidth = canvas.width/2;
             	halfHeight = canvas.height/2;

             	window.scrollTo(0,0);
             }

             function draw() {

             	c.clearRect(0,0,canvas.width, canvas.height);

             	if(touchable) {

             		for(var i=0; i<touches.length; i++) {

             			var touch = touches[i];

             			if(touch.identifier == leftTouchID){
             				c.beginPath();
             				c.strokeStyle = "cyan";
             				c.lineWidth = 6;
             				c.arc(leftTouchStartPos.x, leftTouchStartPos.y, 40,0,Math.PI*2,true);
             				c.stroke();
             				c.beginPath();
             				c.strokeStyle = "cyan";
             				c.lineWidth = 2;
             				c.arc(leftTouchStartPos.x, leftTouchStartPos.y, 60,0,Math.PI*2,true);
             				c.stroke();
             				c.beginPath();
             				c.strokeStyle = "cyan";
             				c.arc(leftTouchPos.x, leftTouchPos.y, 40, 0,Math.PI*2, true);
             				c.stroke();

             			}
             		}
             	}
             }

             function onTouchStart(e) {
             	for(var i = 0; i<e.changedTouches.length; i++){
             		var touch =e.changedTouches[i];
             		leftTouchID = touch.identifier;
             		leftTouchStartPos.reset(touch.clientX, touch.clientY);
             		leftTouchPos.copyFrom(leftTouchStartPos);
             		leftVector.reset(0,0);
             		continue;
             	}
             	touches = e.touches;
             }

             function onTouchMove(e) {

             	e.preventDefault();

             	for(var i = 0; i<e.changedTouches.length; i++){
             		var touch =e.changedTouches[i];
             		if(leftTouchID == touch.identifier)
             		{
             			leftTouchPos.reset(touch.clientX, touch.clientY);
             			leftVector.copyFrom(leftTouchPos);
             			leftVector.minusEq(leftTouchStartPos);
         		var x = leftVector.x;
         		var y = leftVector.y;
         		var x_neg = 0;
         		var y_neg = 0;

         		if (x>100)
         			x = 100;
         		else if (x<-100)
         		  x = -100;
         		if (y>100)
         			y = 100;
         		else if (y<-100)
         			y = -100;
         		y = y * -1;

         		if (x < 0) {
         			x_neg = 1;
         		}
         		if (y < 0) {
         			y_neg = 1;
         		}

         		var value = JSON.stringify([parseInt(Math.abs(x * 2.55)), x_neg, parseInt(Math.abs(y * 2.55)), y_neg]);
         		console.log(value);
             			break;
             		}
             	}

             	touches = e.touches;

             }

             function onTouchEnd(e) {

                	touches = e.touches;

             	for(var i = 0; i<e.changedTouches.length; i++){
             		var touch =e.changedTouches[i];
             		if(leftTouchID == touch.identifier)
             		{
             			leftTouchID = -1;
             			leftVector.reset(0,0);
         		var value = JSON.stringify([0,0,0,0]);
             			break;
             		}
             	}

             }

             function setupCanvas() {

             	canvas = document.createElement( 'canvas' );
             	c = canvas.getContext( '2d' );
             	container = document.createElement( 'div' );
             	container.className = "container";

             	document.body.appendChild( container );
             	container.appendChild(canvas);

             	resetCanvas();

             	c.strokeStyle = "#ffffff";
             	c.lineWidth =2;
             }



      </script>
   </body>
</html>
